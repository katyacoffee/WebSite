{% extends "base_page.html" %}

{% block pagetitle %}
    VLF data
{% endblock %}

{% load static %}

{% block content %}
    <div class="container px-4 py-5" id="main-contents">
        <style>
            .btn {
                float: left;
                display: inline-block;
                background: #68819a;
                font-size: 20px;
                width: 200px;
                color: white;
                font-family: 'Roboto', sans-serif;
                border: #68819a;
                border-radius: 8px;
            }

            .btn:hover {
                background: #5c748c;
                color: #f8f8f8;
            }
        </style>
        <form method="post" id="date_form">
{#        <a href="/date-selection" class="btn">Back to date picker</a>#}
            <input class="btn" type="submit" formaction="/date-selection" value="Back to date picker">
            <input type="hidden" id="source" name="source" value="{{ source }}">
        </form>
        <a href="/" class="btn" style="float: right;">Home Page</a>
    </div>
    <style>
        .new1 div {
          border: 1px solid #0e0e0e;
        }

        .new1 .first-li {
          grid-column-start: 3;
          grid-column-end: 1;
          {#grid-row-start: 1;#}
          {#grid-row-end: 2;#}
        }

        * { box-sizing: border-box; }
        body { margin: 0; border-color: #1a1e21; }

        .grid
        {
          display: grid;
          grid-template-columns: 1fr 1fr;
          {#grid-gap: 10px;#}
          width: 90%;
          margin-left: 5%;

          background-color: #fbfbfc;
          padding: 10px;

          min-height: 100vh;
        }

        .grid__item
        {
          border-radius: 4px;
            border: 1px solid #f6f5f5;
            {#border: 1px solid #030303;#}
          min-height: 20vh;
        }

        .grid__item--small
        {
            background-color: #fbfbfc;
          {#background-color: #e5e9ea;#}
            min-height: 20vh;
            {#float: right;#}
            {#grid-column: 2;#}
        }

        .grid__item--big
        {
          background-color: #fbfbfc;
          grid-row: 5 span;
          {#float: left;#}
            grid-column: 1;
        }

        .btn_view {
                display: inline-flex;
                background: #68819a;
            {#font-size: 16px;#} width: 140px;
                height: 45px;
                color: #ffffff;
                font-size: 20px;
                font-family: 'Roboto', sans-serif;
                border: #68819a;
                border-radius: 8px;
                margin: auto;
                justify-content: center;
                align-items: center;
                vertical-align: center;
        }

        .btn_view:hover {
                background: #5c748c;
                color: #f8f6f6;
        }


        {#body { margin: 0; height: 100vh; overflow: hidden; background: 0% 0% / auto no-repeat url('https://i.stack.imgur.com/m9NKc.png'), #58555c; }#}
        .gallery {
          position: relative; display: flex; flex-flow: row wrap;
          justify-content: space-evenly; align-items: center;
          height: 100%; width: 90%; margin: 0 auto;
          background-color: #fff;
        }
        .gallery img {
          height: auto; width: 200px; margin: 10px;
          box-shadow: 0 0 0 5px #fff, 0 0 0 6px #919191;
          {#transition: .5s linear; cursor: pointer;#}
        }
        .show img { opacity: .25; pointer-events: none; }
        .active {
          transition: box-shadow .5s linear .5s;
          {#transition: box-shadow .5s linear .5s, top 1s ease-out, left 1s ease-out, transform 1s ease-out, width 1s ease-in, height 1s ease-in;#}
          box-shadow: 0 0 0 10px #fff; filter: drop-shadow(1px 2px 6px #000);
          pointer-events: none;
        }
        .close {
          position: relative; left: 100%;
          height: 20px; width: 20px;
          transform: translate(0%, -100%);
          border-radius: 50%;
          box-shadow: 0 0 0 2px #fff, 0 0 2px 2px #000;
          font: bold 20px/20px Arial; text-align: center;
          background-color: #000; color: #fff;
          pointer-events: auto; cursor: pointer;
          {#transition: 1s linear; opacity: 0;#}
          {#transition: 1s linear; opacity: 0;#}
        }
        .active .close:hover { transform: translate(0%, -100%) rotate(.5turn); transition: 1s ease; }

    </style>

    <div class="grid">
        <div class="grid__item grid__item--big">
            <div class="gallery">
{#            <img src="{% static im_all %}" alt="" style="width: 90%; margin-left: 5%;"#}
{#            onclick="largeImg()" id="img1">#}
{#            убрать!#}
            <img src="{% static im_all %}" alt="" style="width: 90%; margin-left: 5%;">
{#            <input type="hidden" id="new_year" name="new_year" value="">#}
            </div>
        </div>
        {% for im in images %}
            <div class="grid__item grid__item--small">
                <img src="{% static im %}" alt="" style="width: 90%; margin-left: 5%;">
            </div>
        {% endfor %}
    </div>
    <div style="align-items: center; margin: 0 auto; text-align: center; font-size: 18px">
        <br>
        <label for="stations" style="font-family: 'Roboto', sans-serif;">Select
            station </label>
        <select id="stations" onchange="stat()"></select>
        <br>
        <br>
        <form method="post" id="gps">
            <button type="submit" formaction="/gps" class="btn_view" onclick="view_data()">View</button>
            <input type="hidden" id="new_stat" name="new_stat" value="">
        </form>
    </div>

    <script>

    // Убрать!
    {#img = document.getElementById("img1");#}
    {#function largeImg() {#}
    {#    img.style.transform = "scale(1.5)";#}
    {#}#}

        const oGallery = document.querySelector('.gallery');
        oGallery.addEventListener('click', function(ev) {
          if (ev.target.tagName != 'IMG') { return false; };
          let oTarget = ev.target, nWidth, nHeight, nRatio = oTarget.offsetWidth / oTarget.offsetHeight;
          let oBig = this.appendChild(document.createElement('DIV'));
          oBig.style.position = `absolute`;
          oBig.style.top = `${oTarget.offsetTop}px`; oBig.style.left = `${oTarget.offsetLeft}px`;
          oBig.style.width = `${oTarget.offsetWidth}px`; oBig.style.height = `${oTarget.offsetHeight}px`;
          if (this.offsetHeight < this.offsetWidth) {
            nHeight = this.offsetHeight; nWidth = nHeight * nRatio;
          } else {
            nWidth = this.offsetWidth; nHeight = nWidth / nRatio;
          };
          oBig.style.background = `center / 100% 100% no-repeat url('${oTarget.currentSrc}')`;
          oBig.insertAdjacentHTML('beforeend', '<div class="close" style="font-size: 20px">×</div>');
          oBig.addEventListener('transitionend', function() { this.querySelector('.close').style.opacity = 1; });
          oBig.addEventListener('click', function(ev) {
            ev.stopPropagation();
            this.addEventListener('transitionend', function() { this.remove(); });
            {#this.style.transition = `.5s ease-in`;#}
            this.style.height = this.style.width = `0px`;
          oGallery.classList.toggle('show', false);
          });
          oBig.classList.toggle('active');
          oBig.style.width = `${nWidth / 0.8}px`; oBig.style.height = `${nHeight / 0.8}px`;
          oBig.style.top = oBig.style.left = `50%`;
          oBig.style.transform = `translate(-50%, -50%) rotate(1turn)`;
          oGallery.classList.toggle('show', true);
        });


        function stat(){
            let selectStat = document.getElementById('stations');
            for (var i = 0; i < 32; i++){
                selectStat.options[selectStat.options.length] = new Option((i+1).toString(), i.toString());
            }
        }
        stat();
        const selectStat = document.getElementById('stations');
        selectStat.selectedIndex = {{ new_stat }} - 1;

        function view_data() {
               const selectStat = document.getElementById('stations');
                let currentStat = selectStat.options[selectStat.selectedIndex].text;
                const new_stat = document.getElementById("new_stat");
                new_stat.value = currentStat;
        }

    </script>
{#    {% else %}Ваш запрос завершился с ошибкой.{% endif %}</div>#}
{% endblock %}
